<form class="form form-horizontal" [formGroup]="AddCollDataForm" (ngSubmit)="AddCollDataForm.valid" #enjiForm="ngForm">
  <lib-ucSubsection [id]="'AddCollDataId'" [title]="'Additional Collateral'" [panel]="'AddCollData'">
  </lib-ucSubsection>
  <div class="form-actions right">
    <button type="button" (click)="open(AdditionalCollateralExistingContent)" class="btn btn-raised btn-warning mr-1"
      translate>
      <i class="fa fa-plus"></i> Add From Existing Collateral
    </button>
    <button type="button" (click)="open(AdditionalCollateralContent)" class="btn btn-raised btn-warning mr-1" translate>
      <i class="fa fa-plus"></i> Add New Collateral
    </button>
  </div>

  <div class="form-body" id="AddCollData">
    <table class="table table-responsive-md text-center table-hover">
      <thead>
        <tr class="table-header">
          <th><span class="thead-header" name='CollNo' translate>No</span>
          </th>
          <th><span style="float: left;" class="thead-header" name='CollName' translate>Collateral Name</span>
          </th>
          <th><span style="float: left;" class="thead-header" name='CollType' translate>Collateral Type</span>
          </th>
          <th><span style="float: right;" class="thead-header" name='CollPrice' translate>Collateral Price</span>
          </th>
          <th><span class="thead-header" name='AddCollOwner' translate>Collateral Owner</span>
          </th>
          <th><span class="thead-header" name='AddCollOwner' translate>Collateral Percentage</span>
          </th>
          <th>Edit</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of listCollateralData; let i = index">
          <td>{{item.CollateralNo}}</td>
          <td align="left">{{item.FullAssetName}}</td>
          <td align="left">{{item.AssetTypeCode}}</td>
          <td align="left">{{item.CollateralValueAmt}}</td>
          <td align="right">{{item.CollateralValueAmt | number}}</td>
          <td align="left">{{item.CollateralPrcnt}}</td>
          <td>{{item.CollateralStat}}</td>
          <td>
            <!-- <a class="success p-0" data-original-title="" title=""
              (click)="editData(AdditionalCollateralContent, item.AppCollateralId)">
              <i class="ft-edit-2 font-medium-3 mr-2"></i>
            </a>
            <a *ngIf="item.CollateralStat == 'NEW'" class="danger p-0" data-original-title="" title=""
              (click)="delete(item.AppCollateralId)">
              <i class="ft-trash-2 font-medium-3 mr-2"></i>
            </a> -->
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="col-md-12" style="padding: 0; text-align: right;">
    <button type="button" class="btn btn-raised btn-warning mr-1" (click)="back()" translate>
      <i class="ft-x"></i> Back
    </button>
    <button type="submit" class="btn btn-raised btn-primary" (click)="next()" translate>
      <i class="fa fa-check-square-o"></i> Save and Continue
    </button>
  </div>
</form>

<ng-template #AdditionalCollateralContent let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title">Additional Collateral - {{type}}</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="px-3">
      <form class="form form-horizontal" #enjiForm="ngForm" [formGroup]="AddCollForm"
        (ngSubmit)="AddCollForm.valid && SaveForm()">
        <lib-ucSubsection [id]="'AddCollInfoId'" [title]="'Collateral Information'" [panel]="'AddCollInfo'">
        </lib-ucSubsection>
        <div id="AddCollInfo">

          <div class="form-group row">
            <label class="col-md-2 adins-required-label" translate>Collateral Type</label>
            <div class="col-md-3">
              <select class="form-control" formControlName="AssetTypeCode" (change)="onItemChange($event.target.value)"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.AssetTypeCode.invalid }">
                <option *ngFor="let item of CollTypeList" [value]="item.Key">{{item.Value}}</option>
              </select>
              <lib-uc-show-errors [control]="AddCollForm.controls.AssetTypeCode" [submit]="enjiForm.submitted">
              </lib-uc-show-errors>
            </div>
          </div>

          <div class="form-group-row">
            <label class="col-md-2 adins-required-label" for="FullAssetName" translate>Collateral Name </label>
            <div class="col-md-3">
              <lib-uclookupgeneric [lookupInput]="inputLookupObj" [parentForm]='AddCollForm' [enjiForm]='enjiForm'
                [identifier]="'FullAssetName'" (lookup)="getLookupCollateralTypeResponse($event)"></lib-uclookupgeneric>
            </div>
            <label class="col-md-3 adins-required-label" translate>Collateral Price</label>
            <div class="col-md-3">
              <input type="text" class="form-control" formControlName="CollateralValueAmt"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.CollateralValueAmt.invalid }">
              <lib-uc-show-errors [control]="AddCollForm.controls.CollateralValueAmt" [submit]="enjiForm.submitted">
              </lib-uc-show-errors>
            </div>
          </div>

          <div class="form-group row">
            <label class="col-md-2 adins-required-label" translate>Manufacturing Year</label>
            <div class="col-md-3">
              <input type="text" class="form-control" formControlName="ManufacturingYear"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.ManufacturingYear.invalid }">
              <lib-uc-show-errors [control]="AddCollForm.controls.ManufacturingYear" [submit]="enjiForm.submitted">
              </lib-uc-show-errors>
            </div>
            <label class="col-md-2 adins-required-label" translate>Collateral Codition</label>
            <div class="col-md-3">
              <select class="form-control" formControlName="MrCollateralConditionCode"
                (change)="onItemChange($event.target.value)"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.MrCollateralConditionCode.invalid }">
                <option *ngFor="let item of ConditionCodeList" [value]="item.Key">{{item.Value}}</option>
              </select>
              <lib-uc-show-errors [control]="AddCollForm.controls.MrCollateralConditionCode"
                [submit]="enjiForm.submitted">
              </lib-uc-show-errors>
            </div>
          </div>

          <div class="form-group row">
            <label class="col-md-2 adins-required-label" translate>Serial No 1</label>
            <div class="col-md-2">
              <input type="text" class="form-control" formControlName="SerialNo1"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.SerialNo1.invalid }">
              <lib-uc-show-errors [control]="AddCollForm.controls.SerialNo1" [submit]="enjiForm.submitted">
              </lib-uc-show-errors>
            </div>
            <label class="col-md-1"></label>
            <label class="col-md-2 adins-required-label" translate>Collateral Usage</label>
            <div class="col-md-3">
              <select class="form-control" formControlName="MrCollateralUsageCode"
                (change)="onItemChange($event.target.value)"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.MrCollateralUsageCode.invalid }">
                <option *ngFor="let item of UsageCodeList" [value]="item.Key">{{item.Value}}</option>
              </select>
              <lib-uc-show-errors [control]="AddCollForm.controls.MrCollateralUsageCode" [submit]="enjiForm.submitted">
              </lib-uc-show-errors>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-2 adins-required-label" translate>Serial No 2</label>
            <div class="col-md-2">
              <input type="text" class="form-control" formControlName="SerialNo2"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.SerialNo2.invalid }">
              <lib-uc-show-errors [control]="AddCollForm.controls.SerialNo2" [submit]="enjiForm.submitted">
              </lib-uc-show-errors>
            </div>
            <label class="col-md-1"></label>
            <label class="col-md-2 adins-required-label" translate>Collateral Tax Date</label>
            <div class="col-md-2">
              <input type="text" class="form-control" formControlName="AssetTaxDt"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.AssetTaxDt.invalid }">
              <lib-uc-show-errors [control]="AddCollForm.controls.AssetTaxDt" [submit]="enjiForm.submitted">
              </lib-uc-show-errors>
            </div>
            <label class="col-md-1"></label>
            <label class="col-md-1"></label>
            <label class="col-md-2 adins-required-label" translate>Serial No 3</label>
            <div class="col-md-2">
              <input type="text" class="form-control" formControlName="SerialNo3"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.SerialNo3.invalid }">
              <lib-uc-show-errors [control]="AddCollForm.controls.SerialNo3" [submit]="enjiForm.submitted">
              </lib-uc-show-errors>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-2 adins-label" translate>Notes</label>
            <div class="col-md-3">
              <textarea type="textarea" row="5" class="form-control" formControlName="Notes"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.Notes.invalid}"></textarea>
            </div>
            <label class="col-md-1"></label>
          </div>
        </div>

        <!-- <lib-ucSubsection [id]="'AddCollAttributeId'" [title]="'Collateral Attribute'" [panel]="'AddCollAttribut'">
        </lib-ucSubsection>
        <div class="form-body" id="CollAttribute" formArrayName="items">
          <table class="table table-responsive-md text-center table-hover">
            <tbody>
              <tr *ngFor="let item of AddCollForm.controls.items.controls; let i = index" [formGroupName]="i">
                <td>
                  <div class="col-md-2">
                    <label class="col-md-2 adins-label" translate>Attr {{i}}</label>
                    <input type="text" class="form-control width-100-per" formControlName="AttrName">
                    <lib-uc-show-errors [control]="AddCollForm.controls.AttrName" [submit]="enjiForm.submitted">
                    </lib-uc-show-errors>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div> -->

        <lib-ucSubsection [id]="'AddCollDocumentId'" [title]="'Collateral Document'" [panel]="'AddCollDocument'">
        </lib-ucSubsection>
        <div class="form-body" id="CollDocument" formArrayName="items">
          <table class="table table-responsive-md text-center table-hover">
            <thead>
              <tr class="table-header">
                <th><span translate class="thead-header">Document</span></th>
                <th><span translate class="thead-header">Recieved</span></th>
                <th><span translate class="thead-header">Document No</span></th>
                <th><span translate class="thead-header">Expired Date</span></th>
                <th><span translate class="thead-header">Document Notes</span></th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of AddCollForm.controls.items.controls; let i = index" [formGroupName]="i">
                <td>{{item.controls.AssetDocName.value}}</td>
                <td>
                  <input type="checkbox" class="border-primary" formControlName="IsReceived">
                </td>
                <td>
                  <input type="text" class="form-control width-100-per" formControlName="DocNo">
                  <lib-uc-show-errors [control]="AddCollForm.controls.DocNo" [submit]="enjiForm.submitted">
                  </lib-uc-show-errors>
                </td>
                <td>
                  <input type="date" class="form-control width-100-per" formControlName="ACDExpiredDt">
                  <lib-uc-show-errors [control]="AddCollForm.controls.ACDExpiredDt" [submit]="enjiForm.submitted">
                  </lib-uc-show-errors>
                </td>
                <td>
                  <input type="text" class="form-control width-100-per" formControlName="DocNotes">
                  <lib-uc-show-errors [control]="AddCollForm.controls.DocNotes" [submit]="enjiForm.submitted">
                  </lib-uc-show-errors>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <lib-ucSubsection [id]="'AddCollOwnerId'" [title]="'Collateral User'" [panel]="'AddCollOwner'">
        </lib-ucSubsection>
        <div id="AddCollUser">
          <div class="form-group row">
            <label class="col-md-2 adins-required-label" translate>Collateral Name</label>
            <div class="col-md-3">
              <input type="text" class="form-control" formControlName="UserName"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.UserName.invalid }">
              <lib-uc-show-errors [control]="AddCollForm.controls.UserName" [submit]="enjiForm.submitted">
              </lib-uc-show-errors>
            </div>
            <label class="col-md-2 adins-required-label" translate>Collateral User Relationship</label>
            <div class="col-md-3">
              <select class="form-control" formControlName="OwnerRelationship"
                (change)="onItemChange($event.target.value)"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.OwnerRelationship.invalid }">
                <option *ngFor="let item of OwnerRelationshipObj" [value]="item.Key">{{item.Value}}</option>
              </select>
              <lib-uc-show-errors [control]="AddCollForm.controls.OwnerRelationship" [submit]="enjiForm.submitted">
              </lib-uc-show-errors>
            </div>
          </div>
        </div>

        <lib-ucSubsection [id]="'AddCollOwnerId'" [title]="'Collateral Owner'" [panel]="'AddCollOwner'">
        </lib-ucSubsection>
        <div id="AddCollOwner">
          <div class="form-group row">
            <label class="col-md-2 adins-required-label" translate>Owner Name</label>
            <div class="col-md-3">
              <input type="text" class="form-control" formControlName="OwnerName"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.OwnerName.invalid }">
              <lib-uc-show-errors [control]="AddCollForm.controls.OwnerName" [submit]="enjiForm.submitted">
              </lib-uc-show-errors>
            </div>
            <label class="col-md-1"></label>
            <label class="col-md-2 adins-required-label" translate>ID Type</label>
            <div class="col-md-2">
              <select class="form-control" formControlName="MrIdType" (change)="onItemChange($event.target.value)"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.MrIdType.invalid }">
                <option *ngFor="let item of IdTypeList" [value]="item.Key">{{item.Value}}</option>
              </select>
              <lib-uc-show-errors [control]="AddCollForm.controls.MrIdType" [submit]="enjiForm.submitted">
              </lib-uc-show-errors>
            </div>
          </div>
          <div class="form-group row">
            <label class="col-md-2 adins-required-label" translate>Owner Relationship</label>
            <div class="col-md-3">
              <select class="form-control" formControlName="OwnerRelationship"
                (change)="onItemChange($event.target.value)"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.OwnerRelationship.invalid }">
                <option *ngFor="let item of OwnerRelationshipObj" [value]="item.Key">{{item.Value}}</option>
              </select>
              <lib-uc-show-errors [control]="AddCollForm.controls.OwnerRelationship" [submit]="enjiForm.submitted">
              </lib-uc-show-errors>
            </div>
            <label class="col-md-1"></label>
            <label class="col-md-2 adins-required-label" translate>Owner Id No</label>
            <div class="col-md-2">
              <input type="text" class="form-control" formControlName="OwnerIdNo"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.OwnerIdNo.invalid }">
              <lib-uc-show-errors [control]="AddCollForm.controls.OwnerIdNo" [submit]="enjiForm.submitted">
              </lib-uc-show-errors>
            </div>

            <label class="col-md-1"></label>
            <label class="col-md-2 adins-required-label" translate>Owner Mobile Phone No</label>
            <div class="col-md-2">
              <input type="text" class="form-control" formControlName="OwnerMobilePhnNo"
                [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.OwnerMobilePhnNo.invalid }">
              <lib-uc-show-errors [control]="AddCollForm.controls.OwnerMobilePhnNo" [submit]="enjiForm.submitted">
              </lib-uc-show-errors>
            </div>

          </div>
          <!-- <div class="form-group row">
            <label class="col-md-2" translate>Copy Address From</label>
            <div class="col-md-4">
              <div class="input-group">
                <select class="form-control" formControlName="CopyFromResidence" [(ngModel)]="copyFromResidence">
                  <option *ngFor="let item of copyToLocationObj" [value]="item.Key">
                    {{item.Value}}
                  </option>
                </select>
                <div class="input-group-append">
                  <span class="input-group-btn">
                    <button class="btn btn-raised btn-primary" type="button" (click)="copyToResidence()">
                      <i class="fa fa-check-square-o"></i>Copy
                    </button>
                  </span>
                </div>
              </div>
            </div>
          </div> -->
          <lib-ucaddress #UcAddrGrp [showSubsection]="false" [UCAddrForm]="AddCollForm" [enjiForm]="enjiForm"
            [identifier]="'legalAddr'" [default]="legalAddrObj" [inputField]="inputFieldLegalObj" [showPhn3]="false">
          </lib-ucaddress>
        </div>

        <lib-ucSubsection [id]="'AddCollLocationId'" [title]="'Collateral Location'" [panel]="'AddCollLocation'">
        </lib-ucSubsection>
        <div id="AddCollLocation">
          <div class="form-group row">
            <label class="col-md-2" translate>Copy Address From</label>
            <div class="col-md-4">
              <div class="input-group">
                <select class="form-control" formControlName="CopyFromLegal" [(ngModel)]="copyFromLegal">
                  <option *ngFor="let item of copyToLocationObj" [value]="item.Key">
                    {{item.Value}}
                  </option>
                </select>
                <div class="input-group-append">
                  <span class="input-group-btn">
                    <button class="btn btn-raised btn-primary" type="button" (click)="copyToLocation()">
                      <i class="fa fa-check-square-o"></i>Copy
                    </button>
                  </span>
                </div>
              </div>
            </div>
          </div>
          <lib-ucaddress #UcAddrGrp [showSubsection]="false" [UCAddrForm]="AddCollForm" [enjiForm]="enjiForm"
            [identifier]="'locationAddr'" [default]="locationAddrObj" [inputField]="inputFieldLocationObj"
            [showPhn3]="false"></lib-ucaddress>
        </div>

        <div class="form-actions right">
          <button type="button" (click)="Cancel()" class="btn btn-raised btn-warning mr-1" translate>
            <i class="fa fa-times "></i> Cancel
          </button>
          <button type="submit" class="btn btn-raised btn-primary">
            <i class="fa fa-check"></i> Save
          </button>
        </div>
      </form>
    </div>
  </div>
</ng-template>


<ng-template #AdditionalCollateralExistingContent let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title">Additional Collateral - {{type}}</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="px-3">
      <form class="form form-horizontal" #enjiForm="ngForm" [formGroup]="AddCollForm"
        (ngSubmit)="AddCollForm.valid && SaveForm()">
        <lib-ucSubsection [id]="'AddCollInfoId'" [title]="'Additional Collateral - Add Existing'"
          [panel]="'AddCollInfo'">
        </lib-ucSubsection>
        <div id="AddCollInfo">
          <lib-UCSearch id="ucSearch" style="width:100%;" [searchInput]='inputObj' (result)="getResult($event)">
          </lib-UCSearch>
          <div>
            <table class="table table-responsive-md text-center table-hover">
              <thead>
                <tr class="table-header">
                  <th><input type="checkbox" [checked]="checkboxAll" (change)="SelectAll($event.target.checked)"
                      id="checkAll" name="CheckAll"></th>
                  <th><span class="thead-header" name='CollNo' translate>No</span>
                  </th>
                  <th><span style="float: left;" class="thead-header" name='CollName' translate>Collateral Name</span>
                  </th>
                  <th><span style="float: left;" class="thead-header" name='CollType' translate>Collateral Type</span>
                  </th>
                  <th><span style="float: left;" class="thead-header" name='MouCustName' translate>Collateral Owner
                      </span>
                  </th>
                  <th><span style="float: right;" class="thead-header" name='CollPrice' translate>Collateral
                      Notes</span>
                  </th>
                  <th><span style="float: right;" class="thead-header" name='CollPrice' translate>Collateral Percentage
                  </span>
                </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of listCollExisting; let i = index">
                  <td>
                    <div *ngIf="listSelectedId.indexOf(item.CollateralId) >- 1">
                      <input type="checkbox" id="checkSame" name="itemSame"
                        (change)="Checked(item.CollateralId, $event.target.checked)" [checked]="true">
                    </div>
                    <div *ngIf="listSelectedId.indexOf(item.CollateralId) < 0">
                      <input type="checkbox" id="checkDiff" name="itemDiff"
                        (change)="Checked(item.CollateralId, $event.target.checked)" [checked]=false>
                    </div>
                  </td>
                  <td>{{item.CollateralNo}}</td>
                  <td align="left">{{item.FullAssetName}}</td>
                  <td align="left">{{item.FullAssetCode}}</td>
                  <td align="left">{{item.CustName}}</td>
                  <td align="right">{{item.CollateralValueAmt | number}}</td>
                </tr>
              </tbody>
            </table>


            <div class="card-header">
              <div class="text-right">
                <button type="button" (click)="addToTemp()" class="btn btn-raised btn-warning mr-1">
                  <i class="fa ft-plus"></i> Add Selected Item
                </button>
              </div>
            </div>

            <table class="table table-responsive-md text-center table-hover">
              <thead>
                <tr class="table-header">
                  <th><span class="thead-header" name='CollNo' translate>Collateral No</span>
                  </th>
                  <th><span style="float: left;" class="thead-header" name='CollName' translate>Collateral Name</span>
                  </th>
                  <th><span style="float: left;" class="thead-header" name='CollType' translate>Collateral Type</span>
                  </th>
                  <th><span style="float: left;" class="thead-header" name='MouCustName' translate>Document Owner
                      Name</span>
                  </th>
                  <th><span style="float: right;" class="thead-header" name='CollPrice' translate>Collateral
                      Price</span>
                  </th>
                  <th translate>Delete</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of tempData; let i = index">
                  <td>
                    <div>
                      <a class="danger p-0" data-original-title="" title=""
                        (click)="deleteFromTemp(item.MouCustCollateralId)">
                        <i class="ft-trash-2 font-medium-3 mr-2"></i>
                      </a></div>
                  </td>
                  <td>{{item.CollateralNo}}</td>
                  <td align="left">{{item.FullAssetName}}</td>
                  <td align="left">{{item.FullAssetCode}}</td>
                  <td align="left">{{item.CustName}}</td>
                  <td align="right">{{item.CollateralValueAmt | number}}</td>
                </tr>
              </tbody>
            </table>


            <div class="card-header">
              <div class="text-right">
                <button type="button" class="btn btn-raised btn-warning mr-1"
                  [routerLink]="['/Verification/QuestionSchemeMemberPaging']"
                  [queryParams]="{VerfSchemeHId:VerfSchemeHId}" translate>
                  <i class="fa fa-arrow-circle-left"></i> Back
                </button>
                <button type="submit" (click)="SaveExistingCollateral()" class="btn btn-raised btn-primary" translate>
                  <i class="fa fa-check"></i> Save
                </button>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</ng-template>