<form class="form form-horizontal" [formGroup]="AddCollDataForm" (ngSubmit)="AddCollDataForm.valid" #enjiForm="ngForm">
  <lib-ucSubsection [id]="'AddCollDataId'" [title]="'Additional Collateral'" [panel]="'AddCollData'">
  </lib-ucSubsection>
  <div *ngIf="type == 'Paging'" class="form-actions right">
    <button type="button" (click)="open('AddExisting')" class="btn btn-raised btn-warning mr-1"
      translate>
      <i class="fa fa-plus"></i> Add Existing
    </button>
    <button type="button" (click)="open('AddEdit')" class="btn btn-raised btn-warning mr-1" translate>
      <i class="fa fa-plus"></i> Add New
    </button>
  </div>

  <div *ngIf="type == 'Paging'" class="form-body" id="AddCollData">
    <table class="table table-responsive-md text-center table-hover">
      <thead>
        <tr class="table-header">
          <th><span class="thead-header" name='CollNo' translate>COLLATERAL NO.</span>
          </th>
          <th><span style="float: left;" class="thead-header" name='CollName' translate>COLLATERAL NAME</span>
          </th>
          <th><span style="float: left;" class="thead-header" name='CollType' translate>COLLATERAL TYPE</span>
          </th>
          <th><span style="float: left;" class="thead-header" name='MouCustName' translate>DOCUMENT OWNER NAME</span>
          </th>
          <th><span style="float: right;" class="thead-header" name='CollPrice' translate>COLLATERAL PRICE</span>
          </th>
          <th><span class="thead-header" name='CollSource' translate>COLLATERAL SOURCE</span>
          </th>
          <th>ACTION</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of listCollateralData; let i = index">
          <td>{{item.CollateralNo}}</td>
          <td align="left">{{item.FullAssetName}}</td>
          <td align="left">{{item.FullAssetCode}}</td>
          <td align="left">{{item.CustName}}</td>
          <td align="right">{{item.CollateralValueAmt | number}}</td>
          <td>{{item.CollateralStat}}</td>
          <td>
            <a class="success p-0" data-original-title="" title=""
              (click)="editData(item.MouCustCollateralId)">
              <i class="ft-edit-2 font-medium-3 mr-2"></i>
            </a>
            <a *ngIf="item.CollateralStat == 'NEW'" class="danger p-0" data-original-title="" title=""
              (click)="delete(item.MouCustCollateralId)">
              <i class="ft-trash-2 font-medium-3 mr-2"></i>
            </a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div *ngIf="type == 'Paging'" class="col-md-12" style="padding: 0; text-align: right;">
    <button type="button" class="btn btn-raised btn-warning mr-1" (click)="back()" translate>
      <i class="ft-x"></i> Back
    </button>
    <button type="submit" class="btn btn-raised btn-primary" (click)="next()" translate>
      <i class="fa fa-check-square-o"></i> Save and Continue
    </button>
  </div>
</form>

<div *ngIf="type == 'AddEdit'" class="px-3">
  <form class="form form-horizontal" #enjiForm="ngForm" [formGroup]="AddCollForm"
    (ngSubmit)="AddCollForm.valid && SaveForm()">
    <lib-ucSubsection [id]="'AddCollInfoId'" [title]="'Additional Collateral Info'" [panel]="'AddCollInfo'">
    </lib-ucSubsection>
    <div id="AddCollInfo">
      <div class="form-group row">
        <label class="col-md-2 adins-required-label" translate>Collateral Type</label>
        <div class="col-md-3">
          <select class="form-control" formControlName="AssetTypeCode" (change)="onItemChange($event.target.value)"
            [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.AssetTypeCode.invalid }">
            <option *ngFor="let item of CollTypeList" [value]="item.Key">{{item.Value}}</option>
          </select>
          <lib-uc-show-errors [control]="AddCollForm.controls.AssetTypeCode" [submit]="enjiForm.submitted">
          </lib-uc-show-errors>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-2 adins-required-label" for="FullAssetName" translate>Collateral Name </label>
        <div class="col-md-3">
          <lib-uclookupgeneric [lookupInput]="inputLookupObj" [parentForm]='AddCollForm' [enjiForm]='enjiForm'
            [identifier]="'FullAssetName'" #LookupCollateral (lookup)="getLookupCollateralTypeResponse($event)"></lib-uclookupgeneric>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-2 adins-required-label" translate>Collateral Condition</label>
        <div class="col-md-3">
          <select class="form-control" formControlName="MrCollateralConditionCode"  (change)="radioChange($event)"
            [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.MrCollateralConditionCode.invalid }">
            <option *ngFor="let item of AssetConditionList" [value]="item.Key">{{item.Value}}</option>
          </select>
          <lib-uc-show-errors [control]="AddCollForm.controls.MrCollateralConditionCode" [submit]="enjiForm.submitted">
          </lib-uc-show-errors>
        </div>
      </div>
      <div formArrayName="items">
        <div *ngFor="let item of items.controls; let i = index;">
          <div class="form-group row" [formGroupName]="i">
            <label class="col-md-2 "[ngClass]="{'adins-required-label': isUsed && item.controls.IsMandatory.value == true}"  translate> {{item.controls.SerialNoLabel.value}} </label> 
            <div class="col-md-3  ">
              <input type="text" class="form-control adInsInput" formControlName="SerialNoValue" [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.items['controls'][i]['controls'].SerialNoValue.invalid}">
              <lib-uc-show-errors  [control]="AddCollForm.controls.items['controls'][i]['controls'].SerialNoValue"
                [submit]="enjiForm.submitted"></lib-uc-show-errors >
            </div>
          </div>
        </div>
      </div> 
 
      <div class="form-group row">
        <label class="col-md-2 adins-required-label" translate>Collateral Price</label>
        <div class="col-md-3">
          <!-- <input type="text" class="form-control" formControlName="CollateralValueAmt"
            [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.CollateralValueAmt.invalid }">
          <lib-uc-show-errors [control]="AddCollForm.controls.CollateralValueAmt" [submit]="enjiForm.submitted">
          </lib-uc-show-errors> -->

          <lib-ucinputnumber [parentForm]="AddCollForm" [identifier]="'CollateralValueAmt'"
          [enjiForm]="enjiForm" [isRequired]="false"
          ucNumber="AddCollForm.controls.CollateralValueAmt.value"></lib-ucinputnumber> 
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-2 adins-label" translate>Notes</label>
        <div class="col-md-3">
          <textarea type="textarea" row="5" class="form-control" formControlName="Notes"
            [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.Notes.invalid}"></textarea>
        </div>
      </div>
    </div>

    <lib-ucSubsection [id]="'AddCollOwnerId'" [title]="'Additional Collateral Owner'" [panel]="'AddCollOwner'">
    </lib-ucSubsection>
    <div id="AddCollOwner">
      <div class="form-group row">
        <label class="col-md-2 adins-required-label" translate>Owner Name</label>
        <div class="col-md-3">
          <input type="text" class="form-control" formControlName="OwnerName"
            [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.OwnerName.invalid }">
          <lib-uc-show-errors [control]="AddCollForm.controls.OwnerName" [submit]="enjiForm.submitted">
          </lib-uc-show-errors>
        </div>
        <label class="col-md-1"></label>
        <label class="col-md-2 adins-required-label" translate>ID Type</label>
        <div class="col-md-2">
          <select class="form-control" formControlName="MrIdType" (change)="onItemChange($event.target.value)"
            [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.MrIdType.invalid }">
            <option *ngFor="let item of IdTypeList" [value]="item.Key">{{item.Value}}</option>
          </select>
          <lib-uc-show-errors [control]="AddCollForm.controls.MrIdType" [submit]="enjiForm.submitted">
          </lib-uc-show-errors>
        </div>
      </div>
      <div class="form-group row">
        <label class="col-md-2 adins-required-label" translate>Owner Relationship</label>
        <div class="col-md-3">
          <select class="form-control" formControlName="OwnerRelationship" (change)="onItemChange($event.target.value)"
            [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.OwnerRelationship.invalid }">
            <option *ngFor="let item of OwnerRelationshipObj" [value]="item.Key">{{item.Value}}</option>
          </select>
          <lib-uc-show-errors [control]="AddCollForm.controls.OwnerRelationship" [submit]="enjiForm.submitted">
          </lib-uc-show-errors>
        </div>
        <label class="col-md-1"></label>
        <label class="col-md-2 adins-required-label" translate>Owner ID No.</label>
        <div class="col-md-2">
          <input type="text" class="form-control" formControlName="OwnerIdNo"
            [ngClass]="{ 'is-invalid': enjiForm.submitted && AddCollForm.controls.OwnerIdNo.invalid }">
          <lib-uc-show-errors [control]="AddCollForm.controls.OwnerIdNo" [submit]="enjiForm.submitted">
          </lib-uc-show-errors>
        </div>
      </div>
      <lib-ucaddress #UcAddrGrp [showSubsection]="false" [UCAddrForm]="AddCollForm" [enjiForm]="enjiForm"
        [identifier]="'legalAddr'" [default]="legalAddrObj" [inputField]="inputFieldLegalObj" [showPhn3]="false">
      </lib-ucaddress>
    </div>

    <lib-ucSubsection [id]="'AddCollLocationId'" [title]="'Collateral Location'" [panel]="'AddCollLocation'">
    </lib-ucSubsection>
    <div id="AddCollLocation">
      <div class="form-group row">
        <label class="col-md-2" translate>Copy Address From</label>
        <div class="col-md-4">
          <div class="input-group">
            <select class="form-control" formControlName="CopyFromLegal">
              <option *ngFor="let item of copyToLocationObj" [value]="item.Key">
                {{item.Value}}
              </option>
            </select>
            <div class="input-group-append">
              <span class="input-group-btn">
                <button class="btn btn-raised btn-primary" type="button" (click)="copyToLocation()">
                  <i class="fa fa-check-square-o"></i>Copy
                </button>
              </span>
            </div>
          </div>
        </div>
      </div>
      <lib-ucaddress #UcAddrGrp [showSubsection]="false" [UCAddrForm]="AddCollForm" [enjiForm]="enjiForm"
        [identifier]="'locationAddr'" [default]="locationAddrObj" [inputField]="inputFieldLocationObj"
        [showPhn3]="false"></lib-ucaddress>
    </div>

    <div class="form-actions right">
      <button type="button" (click)="Cancel()" class="btn btn-raised btn-warning mr-1" translate>
        <i class="fa fa-times "></i> Cancel
      </button>
      <button type="submit" class="btn btn-raised btn-primary">
        <i class="fa fa-check"></i> Save
      </button>
    </div>
  </form>
</div>

<div *ngIf="type == 'AddExisting'" class="px-3">
  <form class="form form-horizontal" #enjiForm="ngForm" [formGroup]="AddCollForm"
    (ngSubmit)="AddCollForm.valid && SaveForm()">
    <lib-ucSubsection [id]="'AddCollInfoId'" [title]="'Additional Collateral - Add Existing'" [panel]="'AddCollInfo'">
    </lib-ucSubsection>
    <div id="AddCollInfo">
      <lib-UCSearch id="ucSearch" style="width:100%;" [searchInput]='inputObj' (result)="getResult($event)">
      </lib-UCSearch>
      <div [hidden]="resultData?.Data == null">
        <table class="table table-responsive-md text-center table-hover">
          <thead>
            <tr class="table-header">
              <th><input type="checkbox" [checked]="checkboxAll" (change)="SelectAll($event.target.checked)"
                  id="checkAll" name="CheckAll"></th>
              <th><span class="thead-header" name='CollNo' translate>COLLATERAL NO.</span>
              </th>
              <th><span style="float: left;" class="thead-header" name='CollName' translate>COLLATERAL NAME</span>
              </th>
              <th><span style="float: left;" class="thead-header" name='CollType' translate>COLLATERAL TYPE</span>
              </th>
              <th><span style="float: left;" class="thead-header" name='MouCustName' translate>DOCUMENT OWNER
                  NAME</span>
              </th>
              <th><span style="float: right;" class="thead-header" name='CollPrice' translate>COLLATERAL
                  PRICE</span>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of listCollExisting; let i = index">
              <td>
                <div *ngIf="listSelectedId.indexOf(item.CollateralId) >- 1">
                  <input type="checkbox" id="checkSame" name="itemSame"
                    (change)="Checked(item.CollateralId, $event.target.checked)" [checked]="true">
                </div>
                <div *ngIf="listSelectedId.indexOf(item.CollateralId) < 0">
                  <input type="checkbox" id="checkDiff" name="itemDiff"
                    (change)="Checked(item.CollateralId, $event.target.checked)" [checked]=false>
                </div>
              </td>
              <td>{{item.CollateralNo}}</td>
              <td align="left">{{item.FullAssetName}}</td>
              <td align="left">{{item.FullAssetCode}}</td>
              <td align="left">{{item.CustName}}</td>
              <td align="right">{{item.CollateralValueAmt | number}}</td>
            </tr>
          </tbody>
        </table>
        <div class="card-header">
          <div class="text-right">
            <button type="button" (click)="addToTemp()" class="btn btn-raised btn-warning mr-1">
              <i class="fa ft-plus"></i> Add Selected Item
            </button>
          </div>
        </div>

        <table class="table table-responsive-md text-center table-hover">
          <thead>
            <tr class="table-header">
              <th><span class="thead-header" name='CollNo' translate>COLLATERAL NO.</span>
              </th>
              <th><span style="float: left;" class="thead-header" name='CollName' translate>COLLATERAL NAME</span>
              </th>
              <th><span style="float: left;" class="thead-header" name='CollType' translate>COLLATERAL TYPE</span>
              </th>
              <th><span style="float: left;" class="thead-header" name='MouCustName' translate>DOCUMENT OWNER
                  NAME</span>
              </th>
              <th><span style="float: right;" class="thead-header" name='CollPrice' translate>COLLATERAL
                  PRICE</span>
              </th>
              <th translate>DELETE</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of tempData; let i = index">
              <td>
                <div>
                  <a class="danger p-0" data-original-title="" title=""
                    (click)="deleteFromTemp(item.MouCustCollateralId)">
                    <i class="ft-trash-2 font-medium-3 mr-2"></i>
                  </a></div>
              </td>
              <td>{{item.CollateralNo}}</td>
              <td align="left">{{item.FullAssetName}}</td>
              <td align="left">{{item.FullAssetCode}}</td>
              <td align="left">{{item.CustName}}</td>
              <td align="right">{{item.CollateralValueAmt | number}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="card-header">
      <div class="text-right">
        <button type="button" class="btn btn-raised btn-warning mr-1" (click)="Cancel()">
          <i class="fa fa-arrow-circle-left"></i> Back
        </button>
        <button type="submit" (click)="SaveExistingCollateral()" class="btn btn-raised btn-primary" translate>
          <i class="fa fa-check"></i> Save
        </button>
      </div>
    </div>
  </form>
</div>